import{d as ut,c as r,g as v,h as u,F as x,r as f,p as R,s as ct,i as gt,o as d,b as t,w as m,k as S,m as H,f as V,v as c,j as C,t as p,n as g,e as K,T as ft,a as bt}from"./runtime-dom.esm-bundler.CUj3j_Ug.js";import{S as _}from"./sweetalert2.esm.all.NNS-RXd7.js";import{u as pt,B as vt,T as kt,a as wt}from"./usePagination.CClfIzvj.js";import{_ as yt}from"./_plugin-vue_export-helper.DlAUqK2U.js";const xt=ut({__name:"data",setup(J,{expose:l}){l();const U=f([]),e=f([]),T=f([]),k=f(!1),a=f(!1),b=f("Tambah User"),w=f(""),G={id:null,nama_lengkap:"",id_level:"",username:"",level:"",status:"",password:"",nip:"",nik:"",golongan:"",pangkat:"",email:"",no_hp:"",id_unit_kerja:null},s=f({...G}),h=f(null),I=R(()=>h.value===1),Y=R(()=>I.value?"col-md-6":"col-md-12"),{page:Q,pageSize:W,totalPages:X,pageStartIndex:Z,pagedItems:q,pages:$,goFirst:tt,goPrev:et,goNext:lt,goLast:at,goTo:ot}=pt(U,{pageSize:10}),N=f(null);ct(h,n=>{s.value.id_level=n!==null?n.toString():"",n!==1&&n!==2&&(s.value.id_unit_kerja=null)}),gt(()=>{j(),z(),M()});async function j(n=""){k.value=!0;try{const i=new URL("/api/backend/user",window.location.origin);n&&i.searchParams.set("search",n);const o=await fetch(i.toString(),{credentials:"include"});if(!o.ok)throw new Error(await o.text());U.value=await o.json()}catch(i){console.error("Gagal memuat data user:",i)}finally{k.value=!1}}async function M(){try{const n=new URL("/api/backend/unit_kerja",window.location.origin),i=await fetch(n.toString(),{credentials:"include"});if(!i.ok)throw new Error(await i.text());T.value=await i.json()}catch(n){console.error("Gagal memuat data user:",n)}}async function z(){k.value=!0;try{const n=new URL("/api/backend/level",window.location.origin),i=await fetch(n.toString(),{credentials:"include"});if(!i.ok)throw new Error(await i.text());const o=await i.json();e.value=o.map(E=>({id:Number(E.id),level:E.level}))}catch(n){console.error("Gagal memuat data user:",n)}finally{k.value=!1}}function nt(){j(w.value.trim())}function B(){N?.value?.show()}function F(){N?.value?.hide()}function it(){b.value="Tambah User",s.value={id:null,id_level:"",nama_lengkap:"",username:"",level:"",status:"",password:"",nip:"",nik:"",golongan:"",pangkat:"",email:"",no_hp:"",id_unit_kerja:null},h.value=null,B()}async function st(n){b.value="Edit User",s.value={id:null,id_level:"",nama_lengkap:"",username:"",level:"",status:"",password:"",nip:"",nik:"",golongan:"",pangkat:"",email:"",no_hp:"",id_unit_kerja:null},B();try{const i=await fetch(`/api/backend/user?id=${n}`,{method:"GET",credentials:"include"});if(!i.ok)throw new Error(await i.text());const o=await i.json();s.value.id=o.id,s.value.nama_lengkap=o.nama_lengkap||"",s.value.username=o.username||"",s.value.status=o.status||"",s.value.nip=o.nip||"",s.value.nik=o.nik||"",s.value.golongan=o.golongan||"",s.value.pangkat=o.pangkat||"",s.value.email=o.email||"",s.value.no_hp=o.no_hp||"",s.value.id_unit_kerja=o.id_unit_kerja!=null?Number(o.id_unit_kerja):null,h.value=o.id_level?Number(o.id_level):null}catch(i){console.error("Gagal memuat detail:",i),_.fire({icon:"error",title:"Oops",text:"Gagal memuat detail."})}}async function rt(n){_.fire({icon:"warning",title:"Peringatan",text:"Anda yakin ingin menghapus user ini?",showCancelButton:!0,confirmButtonText:"Ya, hapus",cancelButtonText:"Tidak"}).then(async i=>{if(i.isConfirmed)try{const o=await fetch(`/api/backend/user?id=${n}`,{method:"DELETE",credentials:"include"});if(!o.ok)throw new Error(await o.text());_.fire({icon:"success",title:"Berhasil",text:"User berhasil dihapus."}),await o.json(),j()}catch{_.fire({icon:"error",title:"Oops",text:"Gagal menghapus user."})}})}async function dt(){a.value=!0;try{const n=!!s.value.id,i=n?`/api/backend/user?id=${s.value.id}`:"/api/backend/user",o=n?"PUT":"POST",{id:E,...mt}=s.value,P={};Object.entries(mt).forEach(([A,y])=>{y!=null&&y!==""&&(P[A]=typeof y=="number"?y:String(y))});const L=e.value.find(A=>A.id===Number(s.value.id_level));L&&(P.level=L.level,P.id_level=String(L.id));const O=await fetch(i,{method:o,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(!O.ok)throw new Error(await O.text());await _.fire({icon:"success",title:"Berhasil!",text:n?"Data berhasil diubah!":"Data berhasil dikirim!"}),F(),await j()}catch(n){console.error("Gagal mengirim data:",n),_.fire({icon:"error",title:"Gagal",text:"Gagal mengirim data."})}finally{a.value=!1}}const D={items:U,data_level:e,unit_kerja:T,loading:k,isSaving:a,modalTitle:b,search:w,emptyForm:G,form:s,selectIdLevel:h,showUnitKerja:I,statusColClass:Y,page:Q,pageSize:W,totalPages:X,pageStartIndex:Z,pagedItems:q,pages:$,goFirst:tt,goPrev:et,goNext:lt,goLast:at,goTo:ot,modalRef:N,fetchList:j,fetchUnitKerja:M,fetchLevel:z,doSearch:nt,showModal:B,hideModal:F,openAdd:it,openEdit:st,hapusEdit:rt,save:dt,Button:wt,TableCard:kt,BaseModal:vt};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),_t={class:"d-flex flex-column flex-md-row justify-content-md-between align-items-center mb-3 text-center text-md-start gap-2"},ht={class:"d-flex align-items-center justify-content-center justify-content-md-start gap-2"},jt={class:"d-flex justify-content-center justify-content-md-end w-100 w-md-auto"},Ct=["onKeydown"],Ut={class:"table-responsive border rounded-4"},Pt={class:"table text-nowrap mb-0 align-middle",id:"page"},St={key:0,class:"badge bg-success fs-2"},Tt={key:1,class:"badge bg-danger fs-2"},Nt=["onClick"],Bt={class:"mt-3",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch","scrollbar-width":"none",width:"100%"}},Et={class:"d-flex justify-content-end","aria-label":"Pagination"},Lt={class:"pagination mb-0 flex-nowrap",style:{"white-space":"nowrap","min-width":"max-content"}},At=["disabled"],Vt=["disabled"],Kt=["onClick"],Gt={key:1,class:"page-link text-muted","aria-hidden":"true",style:{"pointer-events":"none",cursor:"default"}},It=["disabled"],Mt=["disabled"],zt={class:"d-flex flex-column flex-md-row justify-content-md-between align-items-center mb-3 text-center text-md-start gap-2"},Ft={class:"d-flex justify-content-center justify-content-md-end w-100 w-md-auto"},Dt=["onKeydown"],Ot={class:"mt-3",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch","scrollbar-width":"none",width:"100%"}},Rt={class:"d-flex justify-content-end","aria-label":"Pagination"},Ht={class:"pagination mb-0 flex-nowrap",style:{"white-space":"nowrap","min-width":"max-content"}},Jt=["disabled"],Yt=["disabled"],Qt=["onClick"],Wt={key:1,class:"page-link text-muted","aria-hidden":"true",style:{"pointer-events":"none",cursor:"default"}},Xt=["disabled"],Zt=["disabled"],qt=["value"],$t={class:"col-md-6 mb-2"},te={class:"col-md-6 mb-2"},ee={class:"col-md-6 mb-2"},le={class:"col-md-6 mb-2"},ae={class:"col-md-6 mb-2"},oe={class:"col-md-6 mb-2"},ne={class:"col-md-6 mb-2"},ie={class:"col-md-6 mb-2"},se={class:"col-md-6 mb-2"},re={class:"col-md-6 mb-2"},de=["value"],me={key:0,class:"col-md-6 mb-2"},ue=["value"];function ce(J,l,U,e,T,k){return d(),r(x,null,[v(e.TableCard,{loading:e.loading,isEmpty:e.items.length===0,title:"Data User"},{actions:u(()=>[v(e.Button,{class:"btn bg-primary-subtle text-primary",onClick:e.openAdd},{default:u(()=>[...l[23]||(l[23]=[t("i",{class:"ti ti-plus"},null,-1),K(" Tambah ",-1)])]),_:1})]),empty:u(()=>[t("div",zt,[l[29]||(l[29]=t("div",{class:"d-flex align-items-center justify-content-center justify-content-md-start gap-2"},[t("label",{for:"zero_config_length",class:"mb-0"},"Tampilkan"),t("select",{name:"zero_config_length",id:"zero_config_length",class:"form-control w-auto"},[t("option",{value:"10"},"10"),t("option",{value:"25"},"25"),t("option",{value:"50"},"50"),t("option",{value:"100"},"100")])],-1)),t("div",Ft,[m(t("input",{type:"text",name:"cari_kategori",placeholder:"Cari Kategori ...",class:"form-control w-100 w-md-20","onUpdate:modelValue":l[6]||(l[6]=a=>e.search=a),onKeydown:H(V(e.doSearch,["prevent"]),["enter"])},null,40,Dt),[[c,e.search,void 0,{trim:!0}]])])]),l[30]||(l[30]=t("div",{class:"table-responsive border rounded-4"},[t("table",{class:"table text-nowrap mb-0 align-middle",id:"page"},[t("thead",{class:"table-primary"},[t("tr",null,[t("th",null,"No"),t("th",null,"Nama Kategori"),t("th",null,"Aksi")])]),t("tbody",null,[t("tr",null,[t("td",{colspan:"3",class:"text-center"},[t("div",{class:"text-center text-muted py-1"}," Belum ada user ")])])])])],-1)),t("div",Ot,[t("nav",Rt,[t("ul",Ht,[t("li",{class:g(["page-item",{disabled:e.page===1}])},[t("button",{type:"button",class:"page-link",onClick:l[7]||(l[7]=(...a)=>e.goFirst&&e.goFirst(...a)),disabled:e.page===1}," « ",8,Jt)],2),t("li",{class:g(["page-item",{disabled:e.page===1}])},[t("button",{type:"button",class:"page-link",onClick:l[8]||(l[8]=(...a)=>e.goPrev&&e.goPrev(...a)),disabled:e.page===1}," ‹ ",8,Yt)],2),(d(!0),r(x,null,C(e.pages,(a,b)=>(d(),r("li",{key:"p-"+b,class:g(["page-item",{active:a===e.page}])},[a!==null?(d(),r("button",{key:0,type:"button",class:"page-link",onClick:w=>e.goTo(a)},p(a),9,Qt)):(d(),r("span",Wt," … "))],2))),128)),t("li",{class:g(["page-item",{disabled:e.page===e.totalPages}])},[t("button",{type:"button",class:"page-link",onClick:l[9]||(l[9]=(...a)=>e.goNext&&e.goNext(...a)),disabled:e.page===e.totalPages}," › ",8,Xt)],2),t("li",{class:g(["page-item",{disabled:e.page===e.totalPages}])},[t("button",{type:"button",class:"page-link",onClick:l[10]||(l[10]=(...a)=>e.goLast&&e.goLast(...a)),disabled:e.page===e.totalPages}," » ",8,Zt)],2)])])])]),default:u(()=>[t("div",_t,[t("div",ht,[l[25]||(l[25]=t("label",{for:"zero_config_length",class:"mb-0"},"Tampilkan",-1)),m(t("select",{class:"form-control w-auto","onUpdate:modelValue":l[0]||(l[0]=a=>e.pageSize=a)},[...l[24]||(l[24]=[t("option",{value:"10"},"10",-1),t("option",{value:"25"},"25",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)])],512),[[S,e.pageSize,void 0,{number:!0}]])]),t("div",jt,[m(t("input",{type:"text",placeholder:"Cari User ...",class:"form-control w-100 w-md-20","onUpdate:modelValue":l[1]||(l[1]=a=>e.search=a),onKeydown:H(V(e.doSearch,["prevent"]),["enter"])},null,40,Ct),[[c,e.search,void 0,{trim:!0}]])])]),t("div",Ut,[t("table",Pt,[l[28]||(l[28]=t("thead",{class:"table-primary"},[t("tr",null,[t("th",null,"No"),t("th",null,"Nama Lengkap"),t("th",null,"Username"),t("th",null,"Level"),t("th",null,"Status"),t("th",null,"Aksi")])],-1)),t("tbody",null,[(d(!0),r(x,null,C(e.pagedItems,(a,b)=>(d(),r("tr",{key:a.id},[t("td",null,p(e.pageStartIndex+b+1),1),t("td",null,p(a.nama_lengkap),1),t("td",null,p(a.username),1),t("td",null,p(a.level),1),t("td",null,[a.status=="Aktif"?(d(),r("span",St,"Aktif")):(d(),r("span",Tt,"Tidak Aktif"))]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-warning text-white me-2",onClick:w=>e.openEdit(a.id)},[...l[26]||(l[26]=[t("i",{class:"ti ti-edit fs-4"},null,-1)])],8,Nt),v(e.Button,{class:"btn btn-sm btn-danger text-white",onClick:w=>e.hapusEdit(a.id)},{default:u(()=>[...l[27]||(l[27]=[t("i",{class:"ti ti-trash fs-4"},null,-1)])]),_:1},8,["onClick"])])]))),128))])])]),t("div",Bt,[t("nav",Et,[t("ul",Lt,[t("li",{class:g(["page-item",{disabled:e.page===1}])},[t("button",{type:"button",class:"page-link",onClick:l[2]||(l[2]=(...a)=>e.goFirst&&e.goFirst(...a)),disabled:e.page===1},"«",8,At)],2),t("li",{class:g(["page-item",{disabled:e.page===1}])},[t("button",{type:"button",class:"page-link",onClick:l[3]||(l[3]=(...a)=>e.goPrev&&e.goPrev(...a)),disabled:e.page===1},"‹",8,Vt)],2),(d(!0),r(x,null,C(e.pages,(a,b)=>(d(),r("li",{key:"p-"+b,class:g(["page-item",{active:a===e.page}])},[a!==null?(d(),r("button",{key:0,type:"button",class:"page-link",onClick:w=>e.goTo(a)},p(a),9,Kt)):(d(),r("span",Gt,"…"))],2))),128)),t("li",{class:g(["page-item",{disabled:e.page===e.totalPages}])},[t("button",{type:"button",class:"page-link",onClick:l[4]||(l[4]=(...a)=>e.goNext&&e.goNext(...a)),disabled:e.page===e.totalPages},"›",8,It)],2),t("li",{class:g(["page-item",{disabled:e.page===e.totalPages}])},[t("button",{type:"button",class:"page-link",onClick:l[5]||(l[5]=(...a)=>e.goLast&&e.goLast(...a)),disabled:e.page===e.totalPages},"»",8,Mt)],2)])])])]),_:1},8,["loading","isEmpty"]),v(e.BaseModal,{title:e.modalTitle,ref:"modalRef"},{closeButton:u(()=>[t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e.hideModal})]),formModal:u(()=>[t("form",{onSubmit:V(e.save,["prevent"]),class:"row",id:"form-kategori"},[t("input",{type:"hidden",value:e.form.id??""},null,8,qt),t("div",$t,[l[31]||(l[31]=t("label",{class:"form-label"},"Nama Lengkap",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"Nama Lengkap ...","onUpdate:modelValue":l[11]||(l[11]=a=>e.form.nama_lengkap=a)},null,512),[[c,e.form.nama_lengkap,void 0,{trim:!0}]])]),t("div",te,[l[32]||(l[32]=t("label",{class:"form-label"},"NIP",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"NIP ...","onUpdate:modelValue":l[12]||(l[12]=a=>e.form.nip=a)},null,512),[[c,e.form.nip,void 0,{trim:!0}]])]),t("div",ee,[l[33]||(l[33]=t("label",{class:"form-label"},"Pangkat",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"Pangkat ...","onUpdate:modelValue":l[13]||(l[13]=a=>e.form.pangkat=a)},null,512),[[c,e.form.pangkat,void 0,{trim:!0}]])]),t("div",le,[l[34]||(l[34]=t("label",{class:"form-label"},"Golongan",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"Golongan ...","onUpdate:modelValue":l[14]||(l[14]=a=>e.form.golongan=a)},null,512),[[c,e.form.golongan,void 0,{trim:!0}]])]),t("div",ae,[l[35]||(l[35]=t("label",{class:"form-label"},"NIK",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"NIK ...","onUpdate:modelValue":l[15]||(l[15]=a=>e.form.nik=a)},null,512),[[c,e.form.nik,void 0,{trim:!0}]])]),t("div",oe,[l[36]||(l[36]=t("label",{class:"form-label"},"Username",-1)),m(t("input",{type:"text",class:"form-control",placeholder:"Username ...","onUpdate:modelValue":l[16]||(l[16]=a=>e.form.username=a)},null,512),[[c,e.form.username,void 0,{trim:!0}]])]),t("div",ne,[l[37]||(l[37]=t("label",{class:"form-label"},"Password",-1)),m(t("input",{type:"password",class:"form-control",placeholder:"Password ...","onUpdate:modelValue":l[17]||(l[17]=a=>e.form.password=a)},null,512),[[c,e.form.password,void 0,{trim:!0}]])]),t("div",ie,[l[38]||(l[38]=t("label",{class:"form-label"},"Email",-1)),m(t("input",{type:"email",class:"form-control",placeholder:"NIK ...","onUpdate:modelValue":l[18]||(l[18]=a=>e.form.email=a)},null,512),[[c,e.form.email,void 0,{trim:!0}]])]),t("div",se,[l[39]||(l[39]=t("label",{class:"form-label"},"No. Hp",-1)),m(t("input",{type:"email",class:"form-control",placeholder:"No Hp ...","onUpdate:modelValue":l[19]||(l[19]=a=>e.form.no_hp=a)},null,512),[[c,e.form.no_hp,void 0,{trim:!0}]])]),t("div",re,[l[41]||(l[41]=t("label",{class:"form-label"},"Level",-1)),m(t("select",{class:"form-control","onUpdate:modelValue":l[20]||(l[20]=a=>e.selectIdLevel=a)},[l[40]||(l[40]=t("option",{value:null},"Pilih Level",-1)),(d(!0),r(x,null,C(e.data_level,a=>(d(),r("option",{key:a.id,value:a.id},p(a.level),9,de))),128))],512),[[S,e.selectIdLevel,void 0,{number:!0}]])]),v(ft,{name:"fade-in"},{default:u(()=>[e.showUnitKerja?(d(),r("div",me,[l[43]||(l[43]=t("label",{class:"form-label"},"Unit Kerja",-1)),m(t("select",{class:"form-control","onUpdate:modelValue":l[21]||(l[21]=a=>e.form.id_unit_kerja=a)},[l[42]||(l[42]=t("option",{value:null},"Pilih Unit Kerja",-1)),(d(!0),r(x,null,C(e.unit_kerja,a=>(d(),r("option",{key:a.id,value:a.id},p(a.nama),9,ue))),128))],512),[[S,e.form.id_unit_kerja,void 0,{number:!0}]])])):bt("",!0)]),_:1}),t("div",{class:g([e.statusColClass,"mb-2"])},[l[45]||(l[45]=t("label",{class:"form-label"},"Status",-1)),m(t("select",{class:"form-control","onUpdate:modelValue":l[22]||(l[22]=a=>e.form.status=a)},[...l[44]||(l[44]=[t("option",{value:""},"-- Pilih Status --",-1),t("option",{value:"Aktif"},"Aktif",-1),t("option",{value:"Tidak Aktif"},"Tidak Aktif",-1)])],512),[[S,e.form.status,void 0,{trim:!0}]])],2)],32)]),footerModal:u(()=>[v(e.Button,{class:"btn bg-primary-subtle text-primary",onClick:e.save,loading:e.isSaving},{default:u(()=>[...l[46]||(l[46]=[K("Simpan",-1)])]),_:1},8,["loading"]),v(e.Button,{class:"btn bg-danger-subtle text-danger",onClick:e.hideModal},{default:u(()=>[...l[47]||(l[47]=[K("Tutup",-1)])]),_:1})]),_:1},8,["title"])],64)}const ve=yt(xt,[["render",ce]]);export{ve as default};
