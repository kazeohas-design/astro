import{d as pa,c as o,g as K,h,F as v,p as X,r as f,i as ha,s as Y,o as i,b as a,w as m,j as k,t as d,k as V,a as D,m as Z,f as M,v as w,n as y,e as $,y as wa,x as xa}from"./runtime-dom.esm-bundler.CUj3j_Ug.js";import{S as N}from"./sweetalert2.esm.all.NNS-RXd7.js";import{u as ja,B as Sa,T as La,a as Ca}from"./usePagination.CClfIzvj.js";import{_ as Ua}from"./_plugin-vue_export-helper.DlAUqK2U.js";const B="/api/backend/layanan",Pa=pa({__name:"data",props:{level:{},idUnitKerja:{},id_user:{},nama_user:{}},setup(z,{expose:l}){l();const g=z,t=X(()=>g.level==="3"||g.level==="2"),F=X(()=>r.value.id_unit_kerja==null?"":c.value.find(s=>s.id===r.value.id_unit_kerja)?.nama??""),L=f([]),e=f([]),c=f([]),x=f([]),_=f(!1),T=f(!1),I=f("Tambah Layanan"),U=f(""),j=f(null),aa=[10,25,50,100],ta=[{value:"Aktif",label:"Setujui (AKTIF)"},{value:"Revisi",label:"Revisi"},{value:"Ditolak",label:"Tolak"}],ea=[{key:"status_nama",label:"Nama layanan sudah jelas"},{key:"status_jenis",label:"Jenis layanan sesuai"},{key:"status_kanal",label:"Kanal layanan sesuai"},{key:"status_sla",label:"SLA wajar"}],C=f("");function la(n){const s=(n||"").toLowerCase().trim();return s.includes("menunggu")?"bg-warning":s==="aktif"?"bg-success":s==="revisi"||s==="revisi"?"bg-secondary":s==="ditolak"?"bg-danger":"bg-secondary"}const E={id:null,nama:"",jenis:"",kanal:"",status:"",sla_hari:"",status_layanan:"",id_unit_kerja:null,status_nama:!1,status_jenis:!1,status_kanal:!1,status_sla:!1},r=f({...E}),{page:na,pageSize:sa,totalPages:oa,pageStartIndex:ia,pagedItems:ra,pages:da,goFirst:ua,goPrev:ca,goNext:ma,goLast:ga,goTo:fa}=ja(L,{pageSize:10}),A=f(null);ha(()=>{!t.value&&g.idUnitKerja!=null&&(j.value=Number(g.idUnitKerja)),S(U.value.trim(),j.value),O(),J()});async function p(n,s={}){const u=await fetch(n,{credentials:"include",...s});if(!u.ok)throw new Error(await u.text());return await u.json()}async function G(n=null){_.value=!0;try{const s=new URL("/api/backend/riwayat_layanan",window.location.origin);n&&s.searchParams.set("id_layanan",String(n)),x.value=await p(s.toString()),console.log(x.value)}catch(s){console.error("Gagal memuat Data Layanan:",s)}finally{_.value=!1}}function R(n){r.value={id:n?.id??null,nama:n?.nama??"",jenis:n?.jenis??"",kanal:n?.kanal??"",sla_hari:n?.sla_hari??"",status_layanan:n?.status_layanan??"",id_unit_kerja:n?.id_unit_kerja??null,status:"",status_nama:!1,status_jenis:!1,status_kanal:!1,status_sla:!1},C.value=""}async function S(n="",s=null){_.value=!0;try{const u=new URL(B,window.location.origin);n&&u.searchParams.set("search",n),s!=null&&u.searchParams.set("id_unit_kerja",String(s)),u.searchParams.set("valid","0"),u.searchParams.append("status","Aktif"),u.searchParams.append("page","validator");const P=await p(u.toString());L.value=Array.isArray(P)?P:[]}catch(u){console.error("Gagal memuat Data Layanan:",u),L.value=[]}finally{_.value=!1}}async function O(){_.value=!0;try{const n=new URL("/api/backend/kategori",window.location.origin);e.value=await p(n.toString())}catch(n){console.error("Gagal memuat Data Layanan:",n)}finally{_.value=!1}}async function J(){_.value=!0;try{const n=new URL("/api/backend/unit_kerja",window.location.origin);c.value=await p(n.toString())}catch(n){console.error("Gagal memuat Data Layanan:",n)}finally{_.value=!1}}function ya(){S(U.value.trim(),j.value)}Y(j,()=>{S(U.value.trim(),j.value)}),Y(()=>r.value.status,n=>{n!=="Ditolak"&&(C.value="")});function H(){A?.value?.show()}function q(){A?.value?.hide()}async function ba(n){I.value="Validasi Layanan",R(),H(),G(n);try{const s=await p(`${B}?id=${n}`);R(s)}catch(s){console.error("Gagal memuat detail:",s),N.fire({icon:"error",title:"Oops",text:"Gagal memuat detail."})}}async function Q(){if(!(r.value.nama??"").trim()){await N.fire({icon:"warning",title:"Validasi",text:"Layanan tidak boleh kosong."});return}T.value=!0;try{const s=!!r.value.id,u=s?"/api/backend/layanan?riwayat=1":`${B}?riwayat=1`,P="POST",b=new URLSearchParams;r.value.nama&&b.set("layanan",r.value.nama),r.value.id&&b.set("id_layanan",String(r.value.id)),r.value.status&&b.set("status_layanan",r.value.status),b.set("status_nama",r.value.status_nama?"1":"0"),b.set("status_jenis",r.value.status_jenis?"1":"0"),b.set("status_kanal",r.value.status_kanal?"1":"0"),b.set("status_sla",r.value.status_sla?"1":"0"),g.id_user!=null&&b.set("id_user",String(g.id_user)),g.nama_user&&b.set("user",g.nama_user),r.value.status==="Ditolak"&&C.value&&b.set("catatan",C.value),await p(u,{method:P,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:b.toString()}),await N.fire({icon:"success",title:"Berhasil!",text:s?"Layana berhasil divalidasi!":"Data berhasil dikirim!"}),q(),!t.value&&g.idUnitKerja!=null?await S("",Number(g.idUnitKerja)):await S()}catch(s){console.error("Gagal mengirim data:",s),N.fire({icon:"error",title:"Gagal",text:"Gagal mengirim data."})}finally{T.value=!1}}function va(n){r.value.status_layanan=n,Q()}function ka(n){const s=(n||"").toLowerCase().trim();return s.includes("revisi")?"bg-secondary text-dark":s.includes("tolak")||s.includes("ditolak")?"bg-danger":s.includes("aktif")||s.includes("setuju")?"bg-success":"bg-secondary"}function _a(n){const s=(n||"").toLowerCase().trim();return s.includes("revisi")?"REVISI":s.includes("tolak")||s.includes("ditolak")?"DITOLAK":s.includes("aktif")||s.includes("setuju")?"DISETUJUI":n?n.toUpperCase():"-"}const W={props:g,isSuperAdmin:t,unitKerjaLabel:F,items:L,jenisKategori:e,unitKerja:c,dataRiwayat:x,loading:_,isSaving:T,modalTitle:I,searchNama:U,searchUnitKerja:j,apiBase:B,pageSizeOptions:aa,keputusanOptions:ta,checklistItems:ea,catatanValidator:C,statusBadgeClass:la,emptyForm:E,form:r,page:na,pageSize:sa,totalPages:oa,pageStartIndex:ia,pagedItems:ra,pages:da,goFirst:ua,goPrev:ca,goNext:ma,goLast:ga,goTo:fa,modalRef:A,requestJson:p,fetchRiwayat:G,setForm:R,fetchList:S,fetchJenis:O,fetchUnitKerja:J,doSearch:ya,showModal:H,hideModal:q,openEdit:ba,save:Q,setStatusAndSave:va,historyStatusClass:ka,historyStatusLabel:_a,Button:Ca,TableCard:La,BaseModal:Sa};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}}),Ka={class:"d-flex flex-column flex-md-row justify-content-md-between align-items-center mb-3 text-center text-md-start gap-2"},Va={class:"d-flex align-items-center justify-content-center justify-content-md-start gap-2"},Na=["value"],Ba={class:"d-flex flex-column flex-md-row justify-content-center justify-content-md-end w-100 w-md-auto gap-2"},Ta=["onKeydown"],Aa=["value"],Ra={class:"table-responsive border rounded-4"},Da={class:"table text-nowrap mb-0 align-middle",id:"page"},Ma=["onClick"],za={class:"mt-3",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch","scrollbar-width":"none",width:"100%"}},Fa={class:"d-flex justify-content-end","aria-label":"Pagination"},Ia={class:"pagination mb-0 flex-nowrap",style:{"white-space":"nowrap","min-width":"max-content"}},Ea=["disabled"],Ga=["disabled"],Oa=["onClick"],Ja={key:1,class:"page-link text-muted","aria-hidden":"true",style:{"pointer-events":"none",cursor:"default"}},Ha=["disabled"],qa=["disabled"],Qa={class:"d-flex flex-column flex-md-row justify-content-md-between align-items-center mb-3 text-center text-md-start gap-2"},Wa={class:"d-flex align-items-center justify-content-center justify-content-md-start gap-2"},Xa=["value"],Ya={class:"d-flex flex-column flex-md-row justify-content-center justify-content-md-end w-100 w-md-auto gap-2"},Za=["onKeydown"],$a=["value"],at={class:"mt-3",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch","scrollbar-width":"none",width:"100%"}},tt={class:"d-flex justify-content-end","aria-label":"Pagination"},et={class:"pagination mb-0 flex-nowrap",style:{"white-space":"nowrap","min-width":"max-content"}},lt=["disabled"],nt=["disabled"],st=["onClick"],ot={key:1,class:"page-link text-muted","aria-hidden":"true",style:{"pointer-events":"none",cursor:"default"}},it=["disabled"],rt=["disabled"],dt=["value"],ut={class:"row g-4"},ct={class:"col-12 col-lg-6"},mt={class:"mb-3"},gt=["value"],ft={class:"mb-3"},yt={class:"mb-3"},bt={class:"mb-3"},vt={class:"mb-3"},kt={class:"col-12 col-lg-6 validator-col-right"},_t={class:"mb-3"},pt={class:"d-flex flex-column gap-2"},ht=["value"],wt={class:"form-check-label"},xt={key:0,class:"mb-3"},jt={class:"mb-3"},St={class:"d-flex flex-column gap-2"},Lt=["onUpdate:modelValue"],Ct={class:"form-check-label"},Ut={class:"validator-section mt-4"},Pt={class:"validator-history"},Kt={key:0,class:"p-3 text-muted small"},Vt={class:"d-flex align-items-center gap-2 mb-2"},Nt={class:"text-muted small"},Bt={class:"badge bg-light text-dark border"},Tt={class:"d-flex align-items-start gap-2"},At={class:"small text-muted"};function Rt(z,l,g,t,F,L){return i(),o(v,null,[K(t.TableCard,{loading:t.loading,isEmpty:t.items.length===0,title:"Data Layanan"},{empty:h(()=>[a("div",Qa,[a("div",Wa,[l[25]||(l[25]=a("label",{for:"zero_config_length",class:"mb-0"},"Tampilkan",-1)),m(a("select",{name:"zero_config_length",id:"zero_config_length",class:"form-control w-auto","onUpdate:modelValue":l[7]||(l[7]=e=>t.pageSize=e)},[(i(),o(v,null,k(t.pageSizeOptions,e=>a("option",{key:e,value:e},d(e),9,Xa)),64))],512),[[V,t.pageSize,void 0,{number:!0}]])]),a("div",Ya,[m(a("input",{type:"text",name:"cari_layanan",placeholder:"Cari Nama Layanan ...",class:"form-control w-100 w-md-20","onUpdate:modelValue":l[8]||(l[8]=e=>t.searchNama=e),onKeydown:Z(M(t.doSearch,["prevent"]),["enter"])},null,40,Za),[[w,t.searchNama,void 0,{trim:!0}]]),t.isSuperAdmin?m((i(),o("select",{key:0,class:"form-control w-100 w-md-20","onUpdate:modelValue":l[9]||(l[9]=e=>t.searchUnitKerja=e)},[l[26]||(l[26]=a("option",{value:null},"Cari Unit Kerja",-1)),(i(!0),o(v,null,k(t.unitKerja,e=>(i(),o("option",{key:e.id,value:e.id},d(e.nama),9,$a))),128))],512)),[[V,t.searchUnitKerja,void 0,{number:!0}]]):D("",!0)])]),l[27]||(l[27]=a("div",{class:"table-responsive border rounded-4"},[a("table",{class:"table text-nowrap mb-0 align-middle",id:"page"},[a("thead",{class:"table-primary"},[a("tr",null,[a("th",null,"No"),a("th",null,"Nama Layanan"),a("th",null,"Jenis Layanan"),a("th",null,"Penyelesaian"),a("th",null,"Status"),a("th",null,"Aksi")])]),a("tbody",null,[a("tr",null,[a("td",{colspan:"7",class:"text-center"},[a("div",{class:"text-center text-muted py-1"},"Belum ada Layanan")])])])])],-1)),a("div",at,[a("nav",tt,[a("ul",et,[a("li",{class:y(["page-item",{disabled:t.page===1}])},[a("button",{type:"button",class:"page-link",onClick:l[10]||(l[10]=(...e)=>t.goFirst&&t.goFirst(...e)),disabled:t.page===1}," « ",8,lt)],2),a("li",{class:y(["page-item",{disabled:t.page===1}])},[a("button",{type:"button",class:"page-link",onClick:l[11]||(l[11]=(...e)=>t.goPrev&&t.goPrev(...e)),disabled:t.page===1}," ‹ ",8,nt)],2),(i(!0),o(v,null,k(t.pages,(e,c)=>(i(),o("li",{key:"p-"+c,class:y(["page-item",{active:e===t.page}])},[e!==null?(i(),o("button",{key:0,type:"button",class:"page-link",onClick:x=>t.goTo(e)},d(e),9,st)):(i(),o("span",ot," … "))],2))),128)),a("li",{class:y(["page-item",{disabled:t.page===t.totalPages}])},[a("button",{type:"button",class:"page-link",onClick:l[12]||(l[12]=(...e)=>t.goNext&&t.goNext(...e)),disabled:t.page===t.totalPages}," › ",8,it)],2),a("li",{class:y(["page-item",{disabled:t.page===t.totalPages}])},[a("button",{type:"button",class:"page-link",onClick:l[13]||(l[13]=(...e)=>t.goLast&&t.goLast(...e)),disabled:t.page===t.totalPages}," » ",8,rt)],2)])])])]),default:h(()=>[a("div",Ka,[a("div",Va,[l[21]||(l[21]=a("label",{for:"zero_config_length",class:"mb-0"},"Tampilkan",-1)),m(a("select",{class:"form-control w-auto","onUpdate:modelValue":l[0]||(l[0]=e=>t.pageSize=e)},[(i(),o(v,null,k(t.pageSizeOptions,e=>a("option",{key:e,value:e},d(e),9,Na)),64))],512),[[V,t.pageSize,void 0,{number:!0}]])]),a("div",Ba,[m(a("input",{type:"text",name:"cari_layanan",placeholder:"Cari Nama Layanan ...",class:"form-control w-100 w-md-20","onUpdate:modelValue":l[1]||(l[1]=e=>t.searchNama=e),onKeydown:Z(M(t.doSearch,["prevent"]),["enter"])},null,40,Ta),[[w,t.searchNama,void 0,{trim:!0}]]),t.isSuperAdmin?m((i(),o("select",{key:0,class:"form-control w-100 w-md-20","onUpdate:modelValue":l[2]||(l[2]=e=>t.searchUnitKerja=e)},[l[22]||(l[22]=a("option",{value:null},"Cari Unit Kerja",-1)),(i(!0),o(v,null,k(t.unitKerja,e=>(i(),o("option",{key:e.id,value:e.id},d(e.nama),9,Aa))),128))],512)),[[V,t.searchUnitKerja,void 0,{number:!0}]]):D("",!0)])]),a("div",Ra,[a("table",Da,[l[24]||(l[24]=a("thead",{class:"table-primary"},[a("tr",null,[a("th",null,"No"),a("th",null,"Nama Layanan"),a("th",null,"Jenis Layanan"),a("th",null,"Penyelesaian"),a("th",null,"Status"),a("th",null,"Aksi")])],-1)),a("tbody",null,[(i(!0),o(v,null,k(t.pagedItems,(e,c)=>(i(),o("tr",{key:e.id},[a("td",null,d(t.pageStartIndex+c+1),1),a("td",null,d(e.nama),1),a("td",null,d(e.jenis),1),a("td",null,d(e.sla_hari),1),a("td",null,[a("span",{class:y(["badge",t.statusBadgeClass(e.status_layanan)])},d(e.status_layanan),3)]),a("td",null,[a("button",{type:"button",class:"btn btn-sm btn-info text-white me-2",onClick:x=>t.openEdit(e.id)},[...l[23]||(l[23]=[a("i",{class:"ti ti-clipboard-check fs-4"},null,-1)])],8,Ma)])]))),128))])])]),a("div",za,[a("nav",Fa,[a("ul",Ia,[a("li",{class:y(["page-item",{disabled:t.page===1}])},[a("button",{type:"button",class:"page-link",onClick:l[3]||(l[3]=(...e)=>t.goFirst&&t.goFirst(...e)),disabled:t.page===1},"«",8,Ea)],2),a("li",{class:y(["page-item",{disabled:t.page===1}])},[a("button",{type:"button",class:"page-link",onClick:l[4]||(l[4]=(...e)=>t.goPrev&&t.goPrev(...e)),disabled:t.page===1},"‹",8,Ga)],2),(i(!0),o(v,null,k(t.pages,(e,c)=>(i(),o("li",{key:"p-"+c,class:y(["page-item",{active:e===t.page}])},[e!==null?(i(),o("button",{key:0,type:"button",class:"page-link",onClick:x=>t.goTo(e)},d(e),9,Oa)):(i(),o("span",Ja,"…"))],2))),128)),a("li",{class:y(["page-item",{disabled:t.page===t.totalPages}])},[a("button",{type:"button",class:"page-link",onClick:l[5]||(l[5]=(...e)=>t.goNext&&t.goNext(...e)),disabled:t.page===t.totalPages},"›",8,Ha)],2),a("li",{class:y(["page-item",{disabled:t.page===t.totalPages}])},[a("button",{type:"button",class:"page-link",onClick:l[6]||(l[6]=(...e)=>t.goLast&&t.goLast(...e)),disabled:t.page===t.totalPages},"»",8,qa)],2)])])])]),_:1},8,["loading","isEmpty"]),K(t.BaseModal,{title:t.modalTitle,ref:"modalRef"},{closeButton:h(()=>[a("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:t.hideModal})]),formModal:h(()=>[a("form",{onSubmit:M(t.save,["prevent"]),id:"form-unit-kerja"},[a("input",{type:"hidden",value:t.form.id??""},null,8,dt),a("div",ut,[a("div",ct,[a("div",mt,[l[28]||(l[28]=a("label",{class:"form-label"},"Unit Kerja",-1)),a("input",{type:"text",class:"form-control",value:t.unitKerjaLabel,readonly:""},null,8,gt)]),a("div",ft,[l[29]||(l[29]=a("label",{class:"form-label"},"Nama Layanan",-1)),m(a("input",{type:"text",class:"form-control",placeholder:"Layanan ...","onUpdate:modelValue":l[14]||(l[14]=e=>t.form.nama=e),readonly:""},null,512),[[w,t.form.nama,void 0,{trim:!0}]])]),a("div",yt,[l[30]||(l[30]=a("label",{class:"form-label"},"Jenis Layanan",-1)),m(a("input",{type:"text",class:"form-control",placeholder:"Jenis Layanan","onUpdate:modelValue":l[15]||(l[15]=e=>t.form.jenis=e),readonly:""},null,512),[[w,t.form.jenis,void 0,{trim:!0}]])]),a("div",bt,[l[31]||(l[31]=a("label",{class:"form-label"},"Kanal Layanan",-1)),m(a("input",{type:"text",class:"form-control",placeholder:"Kanal Layanan","onUpdate:modelValue":l[16]||(l[16]=e=>t.form.kanal=e),readonly:""},null,512),[[w,t.form.kanal,void 0,{trim:!0}]])]),a("div",vt,[l[32]||(l[32]=a("label",{class:"form-label"},"SLA (Hari)",-1)),m(a("input",{type:"text",class:"form-control",placeholder:"SLA","onUpdate:modelValue":l[17]||(l[17]=e=>t.form.sla_hari=e),readonly:""},null,512),[[w,t.form.sla_hari,void 0,{trim:!0}]])])]),a("div",kt,[a("div",_t,[l[33]||(l[33]=a("label",{class:"form-label"},"Keputusan",-1)),a("div",pt,[(i(),o(v,null,k(t.keputusanOptions,e=>a("label",{key:e.value,class:"form-check d-flex align-items-center gap-2"},[m(a("input",{class:"form-check-input",type:"radio",name:"keputusan",value:e.value,"onUpdate:modelValue":l[18]||(l[18]=c=>t.form.status=c)},null,8,ht),[[wa,t.form.status]]),a("span",wt,d(e.label),1)])),64))])]),t.form.status==="Ditolak"?(i(),o("div",xt,[l[34]||(l[34]=a("label",{class:"form-label"},"Keterangan Penolakan",-1)),m(a("textarea",{class:"form-control",rows:"3",placeholder:"Tulis alasan penolakan...","onUpdate:modelValue":l[19]||(l[19]=e=>t.catatanValidator=e)},null,512),[[w,t.catatanValidator,void 0,{trim:!0}]])])):D("",!0),a("div",jt,[l[35]||(l[35]=a("label",{class:"form-label"},"Checklist Verifikasi",-1)),a("div",St,[(i(),o(v,null,k(t.checklistItems,e=>a("label",{key:e.key,class:"form-check d-flex align-items-center gap-2"},[m(a("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":c=>t.form[e.key]=c},null,8,Lt),[[xa,t.form[e.key]]]),a("span",Ct,d(e.label),1)])),64))])])])]),a("div",Ut,[l[36]||(l[36]=a("label",{class:"form-label mb-2"},"Riwayat Validasi",-1)),a("div",Pt,[t.dataRiwayat.length===0?(i(),o("div",Kt,"Belum ada riwayat.")):(i(!0),o(v,{key:1},k(t.dataRiwayat,e=>(i(),o("div",{key:e.id,class:"riwayat-item p-3"},[a("div",Vt,[a("span",Nt,d(e.tanggal)+" "+d(e.waktu),1),a("span",Bt,d(e.user),1)]),a("div",Tt,[a("span",{class:y(["badge",t.historyStatusClass(e.status_layanan)])},d(t.historyStatusLabel(e.status_layanan)),3),a("div",At,d(e.catatan||"-"),1)])]))),128))])])],32)]),footerModal:h(()=>[K(t.Button,{class:"btn bg-danger-subtle text-dark",onClick:t.hideModal},{default:h(()=>[...l[37]||(l[37]=[$("Tutup",-1)])]),_:1}),K(t.Button,{class:"btn btn-primary text-white",loading:t.isSaving,onClick:l[20]||(l[20]=e=>t.setStatusAndSave("Aktif"))},{default:h(()=>[...l[38]||(l[38]=[$("Simpan",-1)])]),_:1},8,["loading"])]),_:1},8,["title"])],64)}const It=Ua(Pa,[["render",Rt]]);export{It as default};
